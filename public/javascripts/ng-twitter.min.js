!function(e){"use strict";e.module("ngTwitter",["ngSanitize"]).service("linkify",["$sce",function(t){function a(t){return e.element("<div/>").text(t).html()}return{linkify_entities:function(s,i){if(!s.entities)return a(s.text);var n={};s.height=200,e.forEach(s.entities.urls,function(e){n[e.indices[0]]=[e.indices[1],function(){return"<a href='"+a(e.url)+"' class='link' target='_blank'>"+a(e.display_url)+"</a>"}]}),e.forEach(s.entities.hashtags,function(e){n[e.indices[0]]=[e.indices[1],function(t){return"<a href='http://twitter.com/search?q=%23"+a(e.text)+"' class='hash' target='_blank'>"+a(t)+"</a>"}]}),e.forEach(s.entities.user_mentions,function(e){n[e.indices[0]]=[e.indices[1],function(t){return"<a title='"+a(e.name)+"' href='http://twitter.com/"+a(e.screen_name)+"' class='mention' target='_blank'>"+a(t)+"</a>"}]});var o="";e.forEach(s.entities.media||[],function(e){s.height=e.sizes.large.h,s.hasimg=!0,o="<a href='"+s.entities.media[0].expanded_url+"' target='_blank'><img class='img-rounded img-responsive' style='max-height:300px;margin-top: 5px;' src='"+a(e.media_url_https||e.media_url)+"'></img></a>",n[e.indices[0]]=[e.indices[1],function(){return o}]});var r="<table><tbody><tr><td>",c=0,u=0;if(i)r+=o;else{for(u=0;u<s.text.length;++u){var v=n[u];if(v){var l=v[0],R=v[1];u>c&&(r+=a(s.text.substring(c,u))),r+=R(s.text.substring(u,l)),u=l-1,c=l}}u>c&&(r+=a(s.text.substring(c,u))),r+='<span class="hidden-xs info" ng-show="!onlyimages"><a title="Go to twitter page" class="user" href="http://twitter.com/'+s.user.screen_name+'" target="_blank">'+s.user.screen_name+'</a><span title="Retweet Count" class="retweet">'+s.retweet_count+"</span></span>"}return r+="</td></tr></tbody></table>",t.trustAsHtml(r)}}}]).service("twitter",["$http",function(e){return{asyncSearch:function(t,a){var s={},i=a?"&since_id="+a:"",n="/search?hashtag="+encodeURIComponent(t)+i,o=e.get(n,s).then(function(e){return e});return o}}}]).service("scores",["$http",function(e){return{asyncSearch:function(t,a){var s={},i="/queryworldcupscore?codeteam="+t+"&codeawayteam="+a,n=e.get(i,s).then(function(e){return e});return n}}}]).directive("tweets",["$timeout","$interval","$rootScope","$location","$compile","twitter","scores","linkify",function(e,t,a,s,i,n,o,r){return{restrict:"AE",scope:{key:"=",hashtag:"=",refresh:"@",button:"@",hash:"@",count:"@"},template:'<div data-ux-datagrid="tweets" class="datagrid" data-addons="overrides"><script type="template/html" template-name="default" template-item="tweet"><div class="tweet" ng-bind-html="tweet.html" style="height: 80px;"></div></script><script type="template/html" template-name="image" template-item="tweet"><div class="tweet" ng-bind-html="tweet.html" style="height:380px;"></div></script></div>',link:function(i){i.matchs=[{id:"WorldCup #tweets",value:"#worldcup",route:"worldcup"},{id:"20/06 - Switzerland vs France",value:"#SWIvsFRA OR #SWIvFRA OR #SWIFRA",route:"SWIvsFRA_2006",codeteam:"SUI",codeawayteam:"FRA"},{id:"20/06 - Italy vs Costa Rica",value:"#ITAvsCRC OR #ITAvCRC OR #ITACRC",route:"ITAvsCRC_2006",codeteam:"ITA",codeawayteam:"CRC"},{id:"20/06 - Japan vs Greek",value:"#JPNvsGRE OR JPNvGRE OR JPNGRE",route:"CMRvsCRO_2006",codeteam:"JPN",codeawayteam:"GRE"},{id:"19/06 - Uruguay vs England",value:"#URUvsENG OR #URUvENG OR #URUENG",route:"URUvsENG_1906",codeteam:"URU",codeawayteam:"ENG"},{id:"19/06 - Columbia vs Ivoiry",value:"#COLvsCIV OR #COLvCIV OR #COLCIV",route:"COLvsCIV_1906",codeteam:"COL",codeawayteam:"CIV"},{id:"19/06 - Cameroon vs Crotia",value:"#CMRvsCRO OR CMRvCRO OR CMRCRO",route:"CMRvsCRO_1906",codeteam:"CMR",codeawayteam:"CRO"},{id:"18/06 - Spain vs Chili",value:"#SPAvsCHI OR #SPAvCHI OR #SPACHI",route:"SPAvsCHI_1806",codeteam:"ESP",codeawayteam:"CHI"},{id:"18/06 - Australia vs Netherland",value:"#AUSvsNED OR #AUSvNED OR #AUSNED",route:"AUSvsNED_1806",codeteam:"AUS",codeawayteam:"NED"},{id:"18/06 - Russia vs South Korea",value:"#RUSvsKOR OR RUSvKOR OR RUSKOR",route:"RUSvsKOR_1806",codeteam:"RUS",codeawayteam:"KOR"},{id:"17/06 - Brazil vs Mexico",value:"#BRAvsMEX OR #BRAvMEX OR #BRAMEX",route:"BRAvsMEX_1706",codeteam:"BRA",codeawayteam:"MEX"},{id:"17/06 - Belgium vs Algeria",value:"#BELvsALG OR #BELvALG OR #BELALG",route:"BELvsALG_1706",codeteam:"BEL",codeawayteam:"ALG"},{id:"17/06 - Ghana vs USA",value:"#GHAvsUSA OR #GHAvUSA OR #GHAUSA",route:"GHAvsUSA_1706",codeteam:"GHA",codeawayteam:"USA"},{id:"16/06 - Iran vs Nigeria",value:"#IRAvsNIG OR #IRAvNIG OR #IRANIG",route:"IRAvsNIG_1606",codeteam:"IRN",codeawayteam:"NGA"},{id:"16/06 - Germany vs Portugal",value:"#GERvsPOR OR #GERvPOR OR #GERPOR",route:"GERvsPOR_1606",codeteam:"GER",codeawayteam:"POR"},{id:"16/06 - Argentina vs Bosnia",value:"#ARGvsBOS OR #ARGvBOS OR #ARGBOS",route:"ARGvsBOS_1606",codeteam:"ARG",codeawayteam:"BIH"},{id:"15/06 - France vs Hondura",value:"#FRAvsHON OR #FRAvHON OR #FRAHON",route:"FRAvsHON_1506",codeteam:"FRA",codeawayteam:"HON"},{id:"15/06 - Switzerland vs Equator",value:"#SWIECU OR #SWIvsECU OR #SWIvECU",route:"SWIvsECU_1506",codeteam:"SUI",codeawayteam:"ECU"},{id:"15/06 - Ivoiry vs Japan",value:"#CIVJPN OR #CIVvsJPN OR #CIVvJPN",route:"CIVvsJPN_1506",codeteam:"CIV",codeawayteam:"JPN"},{id:"15/06 - England vs Italy",value:"#ENGvsITA OR #ENGvITA OR #ENGITA",route:"ENGvsITA_1506",codeteam:"ENG",codeawayteam:"ITA"},{id:"14/06 - Uruguay vs Costa Rica",value:"#URUvsCRC OR #URUvCRC OR #URUCRC",route:"URUvsCRC_1406",codeteam:"URU",codeawayteam:"CRC"},{id:"14/06 - Columbia vs Greeek",value:"#COLvsGRE OR #COLvGRE OR #COLGRE",route:"COLvsGRE_1406",codeteam:"COL",codeawayteam:"GRE"},{id:"14/06 - Chili vs Australia",value:"#CHIvsAUS OR #CHIvAUS OR #CHIAUX",route:"CHIvsAUS_1406",codeteam:"CHI",codeawayteam:"AUS"},{id:"13/06 - Spain vs Netherland",value:"#SPAvsNED OR #SPAvNED OR #SPANED",route:"SPAvsNED_1306",codeteam:"ESP",codeawayteam:"NED"},{id:"13/06 - Mexique vs Cameroon",value:"#MEXvsCMR OR #MEXvCMR OR #MEXCMR",route:"MEXvsCMR_1306",codeteam:"MEX",codeawayteam:"CMR"},{id:"12/06 - Brasil vs Crotia",value:"#BRAvsCRO OR #BRAvCRO OR #BRACRO",route:"BRAvsCRO_1206",codeteam:"BRA",codeawayteam:"CRO"}];var o,c=n,u=i.refresh?i.refresh:60,v=i.count?parseInt(i.count,10):void 0,l=!1;i.RT=!1,i.counter=u,i.stop=!1,i.tweets=[],i.tweetIDs={},i.onlyimages=!1;i.scrollInterval=null,i.hashtag=i.matchs[0],i.length=0,i.key&&(i.init=function(){i.search(),i.$watch("hashtag",function(e,t){e!==t&&i.search()})},i.search=function(){var e=i.hashtag.value||i.hashtag,t={};c.asyncSearch(e,o).then(function(e){if(i.counter=u,!e.data.errors&&e&&e.data&&e.data.statuses){i.tweets.length>v&&(i.tweets=[]);for(var a=e.data.statuses,s=[],n=0,r=0;r<a.length;r++){var c=a[r];i.RT=!c.retweeted&&!i.tweetIDs[c.id],i.RT?(i.tweetIDs[c.id]=!0,c.html=i.prettyDisplay(c),s.push(c)):n++}i.tweets=l?s.concat(i.tweets):i.tweets.concat(s),i.length=i.tweets.length,t.count=i.length,t.skipping=n,i.$emit("searchResult",t),o=e.data.search_metadata.since_id}})},$("#scroller").hover(function(){i.scrollInterval&&(t.cancel(i.scrollInterval),i.scrollInterval=null,$("html, body").stop(!0))},function(){}),i.scrollTop=function(){$("html, body").animate({scrollTop:0})},i.scrollBottom=function(){$("html, body").animate({scrollTop:$(document).height()})},i.prettyDisplay=function(e){return r.linkify_entities(e,i.onlyimages)},i.images=function(e){i.onlyimages=e},i.$on("search",function(){i.search()}),i.$on("images",function(t,a){e(function(){i.images(a.active)})}),i.$on("scroll",function(){i.scroll()}),i.resetTweets=function(){s.path("/worldcup/"+i.hashtag.route)},a.$on("$locationChangeSuccess",function(){i.tweets=[];var e=s.path();i.hashtag=i.matchs[0];for(var t=0;t<i.matchs.length;t++){var a=i.matchs[t];"/worldcup/"+a.route===e&&(i.tweetIDs={},i.hashtag=a)}i.$emit("newRoute",i.hashtag)}),i.init())}}}])}(angular);