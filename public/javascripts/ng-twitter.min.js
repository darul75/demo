(function(e){"use strict";e.module("ngTwitter",["ngSanitize"]).service("linkify",["$sce",function(t){function n(t){return e.element("<div/>").text(t).html()}return{linkify_entities:function(r,i){if(!r.entities){return n(r.text)}var s={};r.height=200;e.forEach(r.entities.urls,function(e,t){s[e.indices[0]]=[e.indices[1],function(t){return"<a href='"+n(e.url)+"' class='link' target='_blank'>"+n(e.display_url)+"</a>"}]});e.forEach(r.entities.hashtags,function(e,t){s[e.indices[0]]=[e.indices[1],function(t){return"<a href='http://twitter.com/search?q=%23"+n(e.text)+"' class='hash' target='_blank'>"+n(t)+"</a>"}]});e.forEach(r.entities.user_mentions,function(e,t){s[e.indices[0]]=[e.indices[1],function(t){return"<a title='"+n(e.name)+"' href='http://twitter.com/"+n(e.screen_name)+"' class='mention' target='_blank'>"+n(t)+"</a>"}]});var o="";e.forEach(r.entities.media||[],function(e,t){r.height=e.sizes.large.h;r.width=e.sizes.large.w;r.hasimg=true;o="<a href='"+r.entities.media[0].expanded_url+"' target='_blank'><img class='img-rounded img-responsive' style='max-height:300px;margin-top: 5px;' src='"+n(e.media_url_https||e.media_url)+"' width='"+r.width+"' height='"+r.height+"'></img></a>";s[e.indices[0]]=[e.indices[1],function(e){return o}]});var u=!i?"<table><tbody><tr><td>":"";var a=0;var f=0;if(!i){for(f=0;f<r.text.length;++f){var l=s[f];if(l){var c=l[0];var h=l[1];if(f>a){u+=n(r.text.substring(a,f))}u+=h(r.text.substring(f,c));f=c-1;a=c}}if(f>a){u+=n(r.text.substring(a,f))}u+='<span class="hidden-xs info" ng-show="!onlyimages">'+'<a title="Go to twitter page" class="user" href="http://twitter.com/'+r.user.screen_name+'" target="_blank">'+r.user.screen_name+"</a>"+'<span title="Retweet Count" class="retweet">'+r.retweet_count+"</span>"+"</span>"}else{u=r.hasimg?"<table><tbody><tr><td>"+o+"</td></tr></tbody></table>":""}if(!i)u+="</td></tr></tbody></table>";return t.trustAsHtml(u)}}}]).service("twitter",["$http",function(e){return{asyncSearch:function(t,n){var r={};var i=n?"&since_id="+n:"";var s="/search?hashtag="+encodeURIComponent(t)+i;var o=e.get(s,r).then(function(e){return e});return o}}}]).service("scores",["$http",function(e){return{asyncSearch:function(t,n){var r={};var i="/queryworldcupscore?codeteam="+t+"&codeawayteam="+n;var s=e.get(i,r).then(function(e){return e});return s}}}]).directive("tweets",["$timeout","$interval","$rootScope","$location","$compile","twitter","scores","linkify",function(e,t,n,r,i,s,o,u){return{restrict:"AE",scope:{key:"=",hashtag:"=",refresh:"@",button:"@",hash:"@",count:"@"},template:'<div><div ng-if="!onlyimages">'+'<div data-ux-datagrid="tweets" class="datagrid" data-addons="overrides, listLoader, iScrollAddon" data-options="{scrollModel:{manual:false}}">'+'<script type="template/html" template-name="default" template-item="tweet">'+'<div class="tweet" ng-bind-html="tweet.html" style="height: 75px;"></div>'+"</script>"+'<script type="template/html" template-name="image" template-item="tweet">'+'<div class="tweet" ng-bind-html="tweet.html" style="height:395px;"></div>'+"</script>"+"</div>"+"</div>"+'<div ng-if="onlyimages">'+'<div data-ux-datagrid="tweets" class="datagrid data-addons="listLoader, iScrollAddon" data-options="{scrollModel:{manual:false}}">'+'<script type="template/html" template-name="default" template-item="tweet">'+'<div class="tweet" ng-bind-html="tweet.html" style="height:330px;"></div>'+"</script>"+"</div>"+"</div></div>",link:function(i,a,f){i.matchs=[{id:"WorldCup #tweets",value:"#worldcup",route:"worldcup"},{id:"22/06 - South Korea vs Algeria",value:"#KORvsALG OR #KORvALG OR #KORALG",route:"KORvsALG_2206",codeteam:"KOR",codeawayteam:"ALG"},{id:"22/06 - Belgium vs Russia",value:"#BELvsRUS OR #BELvRUS OR #BELRUS",route:"BELvsRUS_2206",codeteam:"BEL",codeawayteam:"RUS"},{id:"22/06 - Nigeria vs Bosnia",value:"#NIGvsBOS OR NIGvBOS OR NIGBOS",route:"NIGvsBOS_2206",codeteam:"NIG",codeawayteam:"BIH"},{id:"21/06 - Germany vs Ghana",value:"#GERvsGHA OR #GERvGHA OR #GERGHA",route:"GERvsGHA_2106",codeteam:"GER",codeawayteam:"GHA"},{id:"21/06 - Argentina vs Iran",value:"#ARGvsIRA OR #ARGvIRA OR #ARGIRA",route:"ARGvsIRA_2106",codeteam:"ARG",codeawayteam:"IRN"},{id:"21/06 - Hondura vs Equator",value:"#HONvsECU OR HONvECU OR HONECU",route:"HONvsECU_2106",codeteam:"HON",codeawayteam:"ECU"},{id:"20/06 - Switzerland vs France",value:"#SWIvsFRA OR #SWIvFRA OR #SWIFRA",route:"SWIvsFRA_2006",codeteam:"SUI",codeawayteam:"FRA"},{id:"20/06 - Italy vs Costa Rica",value:"#ITAvsCRC OR #ITAvCRC OR #ITACRC",route:"ITAvsCRC_2006",codeteam:"ITA",codeawayteam:"CRC"},{id:"20/06 - Japan vs Greek",value:"#JPNvsGRE OR JPNvGRE OR JPNGRE",route:"JPNvsGRE_2006",codeteam:"JPN",codeawayteam:"GRE"},{id:"19/06 - Uruguay vs England",value:"#URUvsENG OR #URUvENG OR #URUENG",route:"URUvsENG_1906",codeteam:"URU",codeawayteam:"ENG"},{id:"19/06 - Columbia vs Ivoiry",value:"#COLvsCIV OR #COLvCIV OR #COLCIV",route:"COLvsCIV_1906",codeteam:"COL",codeawayteam:"CIV"},{id:"19/06 - Cameroon vs Crotia",value:"#CMRvsCRO OR CMRvCRO OR CMRCRO",route:"CMRvsCRO_1906",codeteam:"CMR",codeawayteam:"CRO"},{id:"18/06 - Spain vs Chili",value:"#SPAvsCHI OR #SPAvCHI OR #SPACHI",route:"SPAvsCHI_1806",codeteam:"ESP",codeawayteam:"CHI"},{id:"18/06 - Australia vs Netherland",value:"#AUSvsNED OR #AUSvNED OR #AUSNED",route:"AUSvsNED_1806",codeteam:"AUS",codeawayteam:"NED"},{id:"18/06 - Russia vs South Korea",value:"#RUSvsKOR OR RUSvKOR OR RUSKOR",route:"RUSvsKOR_1806",codeteam:"RUS",codeawayteam:"KOR"},{id:"17/06 - Brazil vs Mexico",value:"#BRAvsMEX OR #BRAvMEX OR #BRAMEX",route:"BRAvsMEX_1706",codeteam:"BRA",codeawayteam:"MEX"},{id:"17/06 - Belgium vs Algeria",value:"#BELvsALG OR #BELvALG OR #BELALG",route:"BELvsALG_1706",codeteam:"BEL",codeawayteam:"ALG"},{id:"17/06 - Ghana vs USA",value:"#GHAvsUSA OR #GHAvUSA OR #GHAUSA",route:"GHAvsUSA_1706",codeteam:"GHA",codeawayteam:"USA"},{id:"16/06 - Iran vs Nigeria",value:"#IRAvsNIG OR #IRAvNIG OR #IRANIG",route:"IRAvsNIG_1606",codeteam:"IRN",codeawayteam:"NGA"},{id:"16/06 - Germany vs Portugal",value:"#GERvsPOR OR #GERvPOR OR #GERPOR",route:"GERvsPOR_1606",codeteam:"GER",codeawayteam:"POR"},{id:"16/06 - Argentina vs Bosnia",value:"#ARGvsBOS OR #ARGvBOS OR #ARGBOS",route:"ARGvsBOS_1606",codeteam:"ARG",codeawayteam:"BIH"},{id:"15/06 - France vs Hondura",value:"#FRAvsHON OR #FRAvHON OR #FRAHON",route:"FRAvsHON_1506",codeteam:"FRA",codeawayteam:"HON"},{id:"15/06 - Switzerland vs Equator",value:"#SWIECU OR #SWIvsECU OR #SWIvECU",route:"SWIvsECU_1506",codeteam:"SUI",codeawayteam:"ECU"},{id:"15/06 - Ivoiry vs Japan",value:"#CIVJPN OR #CIVvsJPN OR #CIVvJPN",route:"CIVvsJPN_1506",codeteam:"CIV",codeawayteam:"JPN"},{id:"15/06 - England vs Italy",value:"#ENGvsITA OR #ENGvITA OR #ENGITA",route:"ENGvsITA_1506",codeteam:"ENG",codeawayteam:"ITA"},{id:"14/06 - Uruguay vs Costa Rica",value:"#URUvsCRC OR #URUvCRC OR #URUCRC",route:"URUvsCRC_1406",codeteam:"URU",codeawayteam:"CRC"},{id:"14/06 - Columbia vs Greeek",value:"#COLvsGRE OR #COLvGRE OR #COLGRE",route:"COLvsGRE_1406",codeteam:"COL",codeawayteam:"GRE"},{id:"14/06 - Chili vs Australia",value:"#CHIvsAUS OR #CHIvAUS OR #CHIAUX",route:"CHIvsAUS_1406",codeteam:"CHI",codeawayteam:"AUS"},{id:"13/06 - Spain vs Netherland",value:"#SPAvsNED OR #SPAvNED OR #SPANED",route:"SPAvsNED_1306",codeteam:"ESP",codeawayteam:"NED"},{id:"13/06 - Mexique vs Cameroon",value:"#MEXvsCMR OR #MEXvCMR OR #MEXCMR",route:"MEXvsCMR_1306",codeteam:"MEX",codeawayteam:"CMR"},{id:"12/06 - Brasil vs Crotia",value:"#BRAvsCRO OR #BRAvCRO OR #BRACRO",route:"BRAvsCRO_1206",codeteam:"BRA",codeawayteam:"CRO"}];var l=s;var c;var h=false;var p;var d=i.refresh?i.refresh:60;var v=i.count?parseInt(i.count,10):undefined;var m=false;i.RT=false;i.counter=d;i.stop=false;i.tweets=[];i.tweetIDs={};i.onlyimages=false;var g=0;i.scrollInterval=null;i.hashtag=i.matchs[0];i.length=0;if(!i.key)return;i.init=function(){i.search();i.$watch("hashtag",function(e,t){if(e!==t){i.search()}})};i.popTweets=[];var y=function(){var e=[];var t=0;var n=i.first?15:30;if(i.popTweets.length/n>=1){while(t<n){var r=i.popTweets.pop();r.html=i.prettyDisplay(r);if(i.onlyimages&&r.hasimg)e.push(r);else if(r&&!i.onlyimages)e.push(r);t++}}var s=i.onlyimages?true:e.length==n;if(e.length>0&&s){var o=i.tweets;var u=o.concat(e);i.tweets=u}};var b=t(y,8e3);i.first=true;i.search=function(){var e=i.hashtag.value||i.hashtag;var t={};$(".loader").show();l.asyncSearch(e,c).then(function(e){i.counter=d;if(e.data.errors){return}if(e&&e.data&&e.data.statuses){if(i.tweets.length>v){i.tweets=[]}var n=e.data.statuses;var r=[];var s=0;for(var o=0;o<n.length;o++){var u=n[o];i.RT=true;if(i.RT){r.push(u)}else{s++}}i.popTweets=m?r.concat(i.popTweets):i.popTweets.concat(r);if(i.first){y();i.first=false}i.length=i.tweets.length;t.count=i.length;t.skipping=s;i.$emit("searchResult",t)}})};i.scrollTop=function(){$("html, body").animate({scrollTop:0})};i.scrollBottom=function(){$("html, body").animate({scrollTop:$(document).height()})};i.prettyDisplay=function(e){return u.linkify_entities(e,i.onlyimages)};i.images=function(e){i.onlyimages=e};i.$on("search",function(e,t){i.search()});i.$on("images",function(t,n){e(function(){i.tweets=[];i.popTweets=[];i.first=true;i.images(n.active)})});i.$on("scroll",function(e,t){i.scroll()});var w=function(){o.asyncSearch(i.hashtag.codeteam,i.hashtag.codeawayteam).then(function(e){if(e&&e.data&&e.data.away_team>=0&&e.data.home_team>=0){var t={};t.home_team=e.data.home_team;t.away_team=e.data.away_team;t.status=e.data.status;i.$emit("scoreResult",t)}},function(e){console.log(e)})};var E=t(w,8e3);i.resetTweets=function(){r.path("/worldcup/"+i.hashtag.route)};n.$on("$locationChangeSuccess",function(e,t,n){i.tweets=[];i.popTweets=[];var s=r.path();i.first=true;i.hashtag=i.matchs[0];for(var o=0;o<i.matchs.length;o++){var u=i.matchs[o];if("/worldcup/"+u.route===s){i.tweetIDs={};i.hashtag=u}}i.$emit("newRoute",i.hashtag)});i.init()}}}])})(angular)