(function(e){"use strict";e.module("ngTwitter",["ngSanitize"]).service("linkify",function(){function t(t){return e.element("<div/>").text(t).html()}return{linkify_entities:function(n,r){if(!n.entities){return t(n.text)}var i={};e.forEach(n.entities.urls,function(e,n){i[e.indices[0]]=[e.indices[1],function(n){return"<a href='"+t(e.url)+"' class='link' target='_blank'>"+t(e.display_url)+"</a>"}]});e.forEach(n.entities.hashtags,function(e,n){i[e.indices[0]]=[e.indices[1],function(n){return"<a href='http://twitter.com/search?q=%23"+t(e.text)+"' class='hash' target='_blank'>"+t(n)+"</a>"}]});e.forEach(n.entities.user_mentions,function(e,n){i[e.indices[0]]=[e.indices[1],function(n){return"<a title='"+t(e.name)+"' href='http://twitter.com/"+t(e.screen_name)+"' class='mention' target='_blank'>"+t(n)+"</a>"}]});var s="";var o=0;var u=0;if(!r){for(u=0;u<n.text.length;++u){var a=i[u];if(a){var f=a[0];var l=a[1];if(u>o){s+=t(n.text.substring(o,u))}s+=l(n.text.substring(u,f));u=f-1;o=f}}if(u>o){s+=t(n.text.substring(o,u))}}if(n.entities.media&&n.entities.media[0]){s+='<div><a href="'+n.entities.media[0].expanded_url+'" target="_blank"><img src="'+n.entities.media[0].media_url+'" /></a></div>'}s+='<span class="info" ng-show="!onlyimages">'+'<a title="Go to twitter page" class="user" href="http://twitter.com/'+n.user.screen_name+'" target="_blank">'+n.user.screen_name+"</a>"+'<span title="Retweet Count" class="retweet">'+n.retweet_count+"</span>"+"</span>";return s}}}).service("twitter",["$http",function(e){return{asyncSearch:function(t,n){var r={};var i=n?"&since_id="+n:"";var s="/search?hashtag="+encodeURIComponent(t)+i;var o=e.get(s,r).then(function(e){return e});return o}}}]).directive("tweets",["$timeout","$interval","$rootScope","$location","twitter","linkify",function(e,t,n,r,i,s){return{restrict:"AE",scope:{key:"=",hashtag:"=",refresh:"@",button:"@",hash:"@",count:"@"},template:'<div class="panel" ng-show="button">'+'<div><button name="START" ng-click="startTimeout()" ng-show="stop">FETCH NEW TWEETS</button>'+'<button name="STOP" ng-click="stopTimeout()" ng-show="!stop">STOP FETCHING TWEETS</button></div>'+'<div><button name="ONLYIMAGES" ng-click="onlyImages()" ng-show="!onlyimages">PICS ONLY</button>'+'<button name="EVERYTHING" ng-click="onlyImages()" ng-show="onlyimages">EVERYTHING</button></div>'+'<div><button name="SCROLL" ng-click="scroll()" ng-show="!scrollInterval">SCROLL AUTO</button>'+'<button name="STOPSCROLL" ng-click="scroll()" ng-show="scrollInterval">STOP SCROLLING AUTO</button></div>'+'<div><button name="TOPSCROLL" ng-click="scrollTop()">SCROLL TOP</button></div>'+'<div><button name="BOTTOMSCROLL" ng-click="scrollBottom()">SCROLL BOTTOM</button></div>'+'<div style="color: #FFFFFF;">- refresh {{counter}}s - #tweets : {{length}}</div>'+"</div>"+'<div class="panel" ng-show="hash">'+"</div>"+'<div class="styled-select">SELECT MATCH HERE:</div>'+'<div class="styled-select"><select ng-model="hashtag" ng-options="r.id for r in matchs" ng-change="resetTweets()"></select></div>'+'<ul class="tweetFavList">'+'<li ng-repeat="tweet in tweets">'+'<p class="tweet" ng-bind-html="prettyDisplay(tweet)" ng-if="!onlyimages || (tweet.entities.media && tweet.entities.media[0])"></p>'+"</li></ul>",link:function(o,u,a){o.matchs=[{id:"Worlcup, select MATCH HERE !!",value:"#worldcup",route:"worldcup"},{id:"12/06 - Brasil vs Crotia",value:"#BRAvsCRO OR #BRAvCRO OR #BRACRO",route:"BRAvsCRO_1206"},{id:"13/06 - Mexique vs Cameroun",value:"#MEXvsCMR OR #MEXvCMR OR #MEXCMR",route:"MEXvsCMR_1306"},{id:"13/06 - Spain vs Netherland",value:"#SPAvsNED OR #SPAvNED OR #SPANED",route:"SPAvsNED_1306"},{id:"14/06 - Chili vs Australia",value:"#CHIvsAUS OR #CHIvAUS OR #CHIAUX",route:"CHIvsAUS_1406"},{id:"14/06 - Columbia vs Greeek",value:"#COLvsGRE OR #COLvGRE OR #COLGRE",route:"COLvsGRE_1406"},{id:"14/06 - Uruguay vs Costa Rica",value:"#URUvsCRC OR #URUvCRC OR #URUCRC",route:"URUvsCRC_1406"},{id:"15/06 - England vs Italy",value:"#ENGvsITA OR #ENGvITA OR #ENGITA",route:"ENGvsITA_1506"},{id:"15/06 - Ivoiry vs Japan",value:"#CIVJPN OR #CIVvsJPN OR #CIVvJPN",route:"CIVvsJPN_1506"},{id:"15/06 - Switzerland vs Equator",value:"#SWIECU OR #SWIvsECU OR #SWIvECU",route:"SWIvsECU_1506"},{id:"15/06 - France vs Hondura",value:"#FRAvsHON OR #FRAvHON OR #FRAHON",route:"FRAvsHON_1506"},{id:"16/06 - Argentina vs Bosnia",value:"#ARGvsBOS OR #ARGvBOS OR #ARGBOS",route:"ARGvsBOS_1606"},{id:"16/06 - Germany vs Portugal",value:"#GERvsPOR OR #GERvPOR OR #GERPOR",route:"GERvsPOR_1606"},{id:"16/06 - Iran vs Nigeria",value:"#IRAvsNIG OR #IRAvNIG OR #IRANIG",route:"IRAvsNIG_1606"}];var f=i;var l;var c=false;var h;var p=o.refresh?o.refresh:60;var d=o.count?parseInt(o.count,10):undefined;o.counter=p;o.stop=false;o.tweets=[];o.onlyimages=false;var v=0;o.scrollInterval=null;o.hashtag=o.matchs[0];o.length=0;if(!o.key)return;o.init=function(){o.search();o.$watch("hashtag",function(e,t){if(e!==t){o.search()}})};o.onTimeout=function(){o.search();m=e(o.onTimeout,p*1e3)};o.onTimeoutCounter=function(){o.counter--;g=e(o.onTimeoutCounter,1e3)};var m=e(o.onTimeout,p*1e3);var g=e(o.onTimeoutCounter,1e3);o.stopTimeout=function(){o.counter=p;o.stop=true;e.cancel(m);e.cancel(g)};o.startTimeout=function(){o.stop=false;m=e(o.onTimeout,p*1e3);g=e(o.onTimeoutCounter,1e3)};o.search=function(){var e=o.hashtag.value||o.hashtag;f.asyncSearch(e,l).then(function(e){o.counter=p;if(e.data.errors){return}if(e&&e.data&&e.data.statuses){if(o.tweets.length<d){o.tweets=o.tweets.concat(e.data.statuses)}else{o.tweets=o.tweets.slice(d,o.tweets.length);o.tweets=o.tweets.concat(e.data.statuses)}o.length=o.tweets.length;l=e.data.search_metadata.since_id}})};$("#scroller").hover(function(){if(o.scrollInterval){t.cancel(o.scrollInterval);o.scrollInterval=null;$("html, body").stop(true)}},function(){});o.scroll=function(){if(o.scrollInterval){t.cancel(o.scrollInterval);o.scrollInterval=null;$("html, body").stop(true)}else{v=$(document).scrollTop();o.scrollInterval=t(function(){v+=300;var e=v+"px";$("html, body").animate({scrollTop:e},2e3,function(){return false})},2e3)}};o.scrollTop=function(){$("html, body").animate({scrollTop:0})};o.scrollBottom=function(){$("html, body").animate({scrollTop:$(document).height()})};o.prettyDisplay=function(e){return s.linkify_entities(e,o.onlyimages)};o.onlyImages=function(){o.onlyimages=!o.onlyimages};o.resetTweets=function(){r.path("/worldcup/"+o.hashtag.route)};n.$on("$locationChangeSuccess",function(e,t,n){var i=r.path();for(var s=0;s<o.matchs.length;s++){var u=o.matchs[s];if("/worldcup/"+u.route===i){o.tweets=[];o.hashtag=u}}});o.init()}}}])})(angular)