(function(e){"use strict";e.module("ngTwitter",["ngSanitize"]).service("linkify",["$sce",function(t){function n(t){return e.element("<div/>").text(t).html()}return{linkify_entities:function(r,i){if(!r.entities){return n(r.text)}var s={};e.forEach(r.entities.urls,function(e,t){s[e.indices[0]]=[e.indices[1],function(t){return"<a href='"+n(e.url)+"' class='link' target='_blank'>"+n(e.display_url)+"</a>"}]});e.forEach(r.entities.hashtags,function(e,t){s[e.indices[0]]=[e.indices[1],function(t){return"<a href='http://twitter.com/search?q=%23"+n(e.text)+"' class='hash' target='_blank'>"+n(t)+"</a>"}]});e.forEach(r.entities.user_mentions,function(e,t){s[e.indices[0]]=[e.indices[1],function(t){return"<a title='"+n(e.name)+"' href='http://twitter.com/"+n(e.screen_name)+"' class='mention' target='_blank'>"+n(t)+"</a>"}]});var o="";var u=0;var a=0;if(!i){for(a=0;a<r.text.length;++a){var f=s[a];if(f){var l=f[0];var c=f[1];if(a>u){o+=n(r.text.substring(u,a))}o+=c(r.text.substring(a,l));a=l-1;u=l}}if(a>u){o+=n(r.text.substring(u,a))}}if(r.entities.media&&r.entities.media[0]){o+='<div><a href="'+r.entities.media[0].expanded_url+'" target="_blank"><img class="img-rounded img-responsive" src="'+r.entities.media[0].media_url+'" /></a></div>'}o+='<span class="info" ng-show="!onlyimages">'+'<a title="Go to twitter page" class="user" href="http://twitter.com/'+r.user.screen_name+'" target="_blank">'+r.user.screen_name+"</a>"+'<span title="Retweet Count" class="retweet">'+r.retweet_count+"</span>"+"</span>";return t.trustAsHtml(o)}}}]).service("twitter",["$http",function(e){return{asyncSearch:function(t,n){var r={};var i=n?"&since_id="+n:"";var s="/search?hashtag="+encodeURIComponent(t)+i;var o=e.get(s,r).then(function(e){return e});return o}}}]).directive("tweets",["$timeout","$interval","$rootScope","$location","$compile","twitter","linkify",function(e,t,n,r,i,s,o){return{restrict:"AE",scope:{key:"=",hashtag:"=",refresh:"@",button:"@",hash:"@",count:"@"},template:'<div class="tweetFavList">'+'<div ng-repeat="tweet in tweets" class="tweet" ng-bind-html="prettyDisplay(tweet)" ng-if="!onlyimages || (tweet.entities.media && tweet.entities.media[0])"></div>'+"</div>",link:function(i,u,a){i.matchs=[{id:"WorldCup #tweets",value:"#worldcup",route:"worldcup"},{id:"18/06 - Spain vs Chili",value:"#SPAvsCHI OR #SPAvCHI OR #SPACHI",route:"SPAvsCHI_1806"},{id:"18/06 - Australia vs Netherland",value:"#AUSvsNED OR #AUSvNED OR #AUSNED",route:"AUSvsNED_1806"},{id:"18/06 - Russia vs South Korea",value:"#RUSvsKOR OR RUSvKOR OR RUSKOR",route:"RUSvsKOR_1806"},{id:"17/06 - Brazil vs Mexico",value:"#BRAvsMEX OR #BRAvMEX OR #BRAMEX",route:"BRAvsMEX_1706"},{id:"17/06 - Belgium vs Algeria",value:"#BELvsALG OR #BELvALG OR #BELALG",route:"BELvsALG_1706"},{id:"17/06 - Ghana vs USA",value:"#GHAvsUSA OR #GHAvUSA OR #GHAUSA",route:"GHAvsUSA_1706"},{id:"16/06 - Iran vs Nigeria",value:"#IRAvsNIG OR #IRAvNIG OR #IRANIG",route:"IRAvsNIG_1606"},{id:"16/06 - Germany vs Portugal",value:"#GERvsPOR OR #GERvPOR OR #GERPOR",route:"GERvsPOR_1606"},{id:"16/06 - Argentina vs Bosnia",value:"#ARGvsBOS OR #ARGvBOS OR #ARGBOS",route:"ARGvsBOS_1606"},{id:"15/06 - France vs Hondura",value:"#FRAvsHON OR #FRAvHON OR #FRAHON",route:"FRAvsHON_1506"},{id:"15/06 - Switzerland vs Equator",value:"#SWIECU OR #SWIvsECU OR #SWIvECU",route:"SWIvsECU_1506"},{id:"15/06 - Ivoiry vs Japan",value:"#CIVJPN OR #CIVvsJPN OR #CIVvJPN",route:"CIVvsJPN_1506"},{id:"15/06 - England vs Italy",value:"#ENGvsITA OR #ENGvITA OR #ENGITA",route:"ENGvsITA_1506"},{id:"14/06 - Uruguay vs Costa Rica",value:"#URUvsCRC OR #URUvCRC OR #URUCRC",route:"URUvsCRC_1406"},{id:"14/06 - Columbia vs Greeek",value:"#COLvsGRE OR #COLvGRE OR #COLGRE",route:"COLvsGRE_1406"},{id:"14/06 - Chili vs Australia",value:"#CHIvsAUS OR #CHIvAUS OR #CHIAUX",route:"CHIvsAUS_1406"},{id:"13/06 - Spain vs Netherland",value:"#SPAvsNED OR #SPAvNED OR #SPANED",route:"SPAvsNED_1306"},{id:"13/06 - Mexique vs Cameroun",value:"#MEXvsCMR OR #MEXvCMR OR #MEXCMR",route:"MEXvsCMR_1306"},{id:"12/06 - Brasil vs Crotia",value:"#BRAvsCRO OR #BRAvCRO OR #BRACRO",route:"BRAvsCRO_1206"}];var f=s;var l;var c=false;var h;var p=i.refresh?i.refresh:60;var d=i.count?parseInt(i.count,10):undefined;i.counter=p;i.stop=false;i.tweets=[];i.onlyimages=false;var v=0;i.scrollInterval=null;i.hashtag=i.matchs[0];i.length=0;if(!i.key)return;i.init=function(){i.search();i.$watch("hashtag",function(e,t){if(e!==t){i.search()}})};i.search=function(){var e=i.hashtag.value||i.hashtag;f.asyncSearch(e,l).then(function(e){i.counter=p;if(e.data.errors){return}if(e&&e.data&&e.data.statuses){if(i.tweets.length<d){i.tweets=i.tweets.concat(e.data.statuses)}else{i.tweets=i.tweets.slice(d,i.tweets.length);i.tweets=i.tweets.concat(e.data.statuses)}i.length=i.tweets.length;l=e.data.search_metadata.since_id}})};$("#scroller").hover(function(){if(i.scrollInterval){t.cancel(i.scrollInterval);i.scrollInterval=null;$("html, body").stop(true)}},function(){});i.scrollTop=function(){$("html, body").animate({scrollTop:0})};i.scrollBottom=function(){$("html, body").animate({scrollTop:$(document).height()})};i.prettyDisplay=function(e){return o.linkify_entities(e,i.onlyimages)};i.images=function(e){i.onlyimages=e};i.$on("search",function(e,t){i.search()});i.$on("images",function(t,n){e(function(){i.images(n.active)})});i.$on("scroll",function(e,t){i.scroll()});i.resetTweets=function(){r.path("/worldcup/"+i.hashtag.route)};n.$on("$locationChangeSuccess",function(e,t,n){var s=r.path();for(var o=0;o<i.matchs.length;o++){var u=i.matchs[o];if("/worldcup/"+u.route===s){i.tweets=[];i.hashtag=u}}});i.init()}}}])})(angular)