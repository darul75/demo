{"filter":false,"title":"ng-twitter.js","tooltip":"/public/javascripts/ng-twitter.js","ace":{"folds":[],"scrolltop":2138,"scrollleft":0,"selection":{"start":{"row":165,"column":12},"end":{"row":165,"column":12},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"hash":"557dce45c984e3ff9c1ad34174c4d9e6b5fc5e3e","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":165,"column":12},"action":"insert","lines":["(function (angular) {","'use strict';\t","","\tangular.module('ngTwitter', ['ngSanitize'])\t","\t\t// TWEET LINKIFIER","\t\t.service('linkify', function() {"," ","\t\t\tfunction escapeHTML(text) {","\t\t\t\treturn angular.element('<div/>').text(text).html();","\t\t\t}"," ","\t\t\treturn {","\t\t\t\tlinkify_entities: function(tweet) {","\t\t\t\t\tif (!(tweet.entities)) {","\t\t\t\t\t\treturn escapeHTML(tweet.text);","\t\t\t\t\t}","\t\t\t\t\t// This is very naive, should find a better way to parse this","\t\t\t\t\tvar index_map = {};","\t\t\t\t\tangular.forEach(tweet.entities.urls, function(entry,i) {","\t\t\t\t\t\tindex_map[entry.indices[0]] = [entry.indices[1], function(text) {return \"<a href='\"+escapeHTML(entry.url)+\"' class='link' target='_blank'>\"+escapeHTML(entry.display_url)+\"</a>\";}];","\t\t\t\t\t});","\t\t\t\t\tangular.forEach(tweet.entities.hashtags, function(entry,i) {","\t\t\t\t\t\tindex_map[entry.indices[0]] = [entry.indices[1], function(text) {return \"<a href='http://twitter.com/search?q=%23\"+escapeHTML(entry.text)+\"' class='hash' target='_blank'>\"+escapeHTML(text)+\"</a>\";}];","\t\t\t\t\t});","\t\t\t\t\tangular.forEach(tweet.entities.user_mentions, function(entry,i) {","\t\t\t\t\t\tindex_map[entry.indices[0]] = [entry.indices[1], function(text) {return \"<a title='\"+escapeHTML(entry.name)+\"' href='http://twitter.com/\"+escapeHTML(entry.screen_name)+\"' class='mention' target='_blank'>\"+escapeHTML(text)+\"</a>\";}];","\t\t\t\t\t});","\t\t\t\t\tvar result = \"\";","\t\t\t\t\tvar last_i = 0;","\t\t\t\t\tvar i = 0;","\t\t\t\t\t// iterate through the string looking for matches in the index_map","\t\t\t\t\tfor (i=0; i < tweet.text.length; ++i) {","\t\t\t\t\t\tvar ind = index_map[i];","\t\t\t\t\t\tif (ind) {","\t\t\t\t\t\t\tvar end = ind[0];","\t\t\t\t\t\t\tvar func = ind[1];","\t\t\t\t\t\t\tif (i > last_i) {","\t\t\t\t\t\t\t\tresult += escapeHTML(tweet.text.substring(last_i, i));","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tresult += func(tweet.text.substring(i, end));","\t\t\t\t\t\t\ti = end - 1;","\t\t\t\t\t\t\tlast_i = end;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tif (i > last_i) {","\t\t\t\t\t\tresult += escapeHTML(tweet.text.substring(last_i, i));","\t\t\t\t\t}","\t\t\t\t\treturn result;","\t\t\t\t}","\t\t\t};","\t\t})","\t\t// TWEETER SERVICE AUTH AND QUERY","\t\t.service('twitter', ['$http', function (http) {\t\t\t","\t\t\treturn {","\t\t\t\tasyncSearch: function(hashtag, since) {","\t\t\t\t\tvar cfg = {};","\t\t\t\t\tvar paramSince = since ? '&since_id='+ since : '';","\t\t\t\t\t//var queryUrl = 'https://api.twitter.com/1.1/search/tweets.json?q=%23'+hashtag+paramSince;","\t\t\t\t\tvar queryUrl = '/search?hashtag='+hashtag+paramSince;","\t\t\t\t\tvar promise = http.get(queryUrl, cfg).then(function (response) {\t\t\t\t\t\t","\t\t\t\t\t\treturn response;","\t\t\t\t\t});","\t\t\t\t\treturn promise;","\t\t\t\t}","\t\t\t};","        }])","\t\t// DIRECTIVE","\t\t.directive('tweets', ['$timeout', 'twitter', 'linkify', function(timeout, twitter, linkify) {","\t\t\treturn {","\t\t\t\trestrict : 'AE',","\t\t\t\tscope: { key:'=', hashtag: '=', refresh:'@', button:'@', hash:'@', count:'@'},\t\t\t","\t\t\t\ttemplate: ","\t\t\t\t\t'<div class=\"panel\" ng-show=\"button\">' + ","\t\t\t\t\t\t'<button name=\"start\" ng-click=\"startTimeout()\" ng-show=\"stop\">start</button>' + ","\t\t\t\t\t\t'<button name=\"stop\" ng-click=\"stopTimeout()\" ng-show=\"!stop\">stop</button>' +","\t\t\t\t\t\t' Refreshing in {{counter}}' + ","\t\t\t\t\t'</div>' +\t\t\t\t","\t\t\t\t\t'<div class=\"panel\" ng-show=\"hash\">' +","\t\t\t\t\t\t'<input type=\"text\" name=\"input\" ng-model=\"hashtag\">' +","\t\t\t\t\t'</div>' +\t","\t\t\t\t\t'<ul class=\"tweetFavList\">'+ ","\t\t\t\t\t\t'<li ng-repeat=\"tweet in tweets\">' +","\t\t\t\t\t\t\t'<p ng-bind-html=\"prettyDisplay(tweet)\"><p>' +","\t\t\t\t\t\t\t'<div class=\"info\">' +\t\t\t\t\t\t\t","\t\t\t\t\t\t\t\t'<a title=\"Go to twitter page\" class=\"user\" href=\"http://twitter.com/{{tweet.user.screen_name}}\" target=\"_blank\">{{tweet.user.screen_name}}</a>'+ ","\t\t\t\t\t\t\t\t'<span title=\"Retweet Count\" class=\"retweet\">{{tweet.retweet_count}}</span>' + ","\t\t\t\t\t\t\t'</div>' +","\t\t\t\t\t'</li></ul>',","\t\t\t\tlink : function(scope, element, attrs) {","\t\t\t\t\tvar service = twitter;","\t\t\t\t\tvar since_id;","\t\t\t\t\tvar init = false;","\t\t\t\t\tvar bearer;","\t\t\t\t\tvar refresh = scope.refresh ? scope.refresh : 60;","\t\t\t\t\tvar count = scope.count ? scope.count : undefined;","\t\t\t\t\tscope.counter = refresh;","\t\t\t\t\tscope.stop = false;","\t\t\t\t\tscope.tweets = [];","","\t\t\t\t\tif (!scope.key)","\t\t\t\t\t\treturn;\t\t\t\t","","\t\t\t\t\tscope.init = function() {","\t\t\t\t\t\t// HANDLE SERVER SIDE","\t\t\t\t\t\tscope.search();","\t\t\t\t\t\t","\t\t\t\t\t\t// LOCAL MODE BUT CORS","\t\t\t\t\t\tscope.$watch('hashtag', function(newValue, oldValue) {","\t\t\t\t\t\t\tif ( newValue !== oldValue) {","\t\t\t\t\t\t\t\tscope.search();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t});","\t\t\t\t\t};","","\t\t\t\t\tscope.onTimeout = function() {\t\t\t\t\t\t","\t\t\t\t\t\tscope.search();","\t\t\t\t\t\tmytimeout = timeout(scope.onTimeout,refresh*1000);","\t\t\t\t\t};","","\t\t\t\t\tscope.onTimeoutCounter = function() {","\t\t\t\t\t\tscope.counter--;\t\t\t\t\t\t","\t\t\t\t\t\tmytimeoutcounter = timeout(scope.onTimeoutCounter,1000);","\t\t\t\t\t};","","\t\t\t\t\tvar mytimeout = timeout(scope.onTimeout,refresh*1000);","\t\t\t\t\tvar mytimeoutcounter = timeout(scope.onTimeoutCounter,1000);","","\t\t\t\t\tscope.stopTimeout = function() {","\t\t\t\t\t\tscope.counter = refresh;","\t\t\t\t\t\tscope.stop = true;","\t\t\t\t\t\ttimeout.cancel(mytimeout);","\t\t\t\t\t\ttimeout.cancel(mytimeoutcounter);","\t\t\t\t\t};","","\t\t\t\t\tscope.startTimeout = function() {","\t\t\t\t\t\tscope.stop = false;","\t\t\t\t\t\tmytimeout = timeout(scope.onTimeout,refresh*1000);","\t\t\t\t\t\tmytimeoutcounter = timeout(scope.onTimeoutCounter,1000);","\t\t\t\t\t};","","\t\t\t\t\tscope.search = function() {","\t\t\t\t\t\tservice.asyncSearch(scope.hashtag, since_id).then(function(d) {","\t\t\t\t\t\t\tscope.counter = refresh;","\t\t\t\t\t\t\tif (d.data.errors)","\t\t\t\t\t\t\t{","\t\t\t\t\t\t\t\tconsole.log(d.data.errors[0]);","\t\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t","\t\t\t\t\t\t\tif (d && d.data && d.data.statuses) {","\t\t\t\t\t\t\t\tscope.tweets = d.data.statuses;","\t\t\t\t\t\t\t\tif (count)","\t\t\t\t\t\t\t\t\tscope.tweets = scope.tweets.slice(0, count);","\t\t\t\t\t\t\t\tsince_id = d.data.search_metadata.since_id;","\t\t\t\t\t\t\t}\t\t\t\t\t\t\t","\t\t\t\t\t\t});","\t\t\t\t\t};","","\t\t\t\t\tscope.prettyDisplay = function(tweet) {","\t\t\t\t\t\treturn linkify.linkify_entities(tweet);","\t\t\t\t\t};","","\t\t\t\t\tscope.init();","\t\t\t\t}","\t\t\t};","\t\t}]);","})(angular);"]}]}]]},"timestamp":1421348731527}